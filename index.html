<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤ Svenska + Engelska RÃ¶ster + Record</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            max-width: 1100px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { color: #4a5568; margin-bottom: 10px; text-align: center; }
        .subtitle { text-align: center; color: #666; margin-bottom: 25px; }
        
        /* ULTRA-LÃ…NGSAM HÃ–GTEXTNING */
        .text-container {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            min-height: 180px;
            margin-bottom: 20px;
            font-size: 22px;
            line-height: 1.9;
            overflow-y: auto;
            max-height: 320px;
        }
        .word {
            display: inline-block;
            margin: 0 4px 10px 0;
            padding: 5px 8px;
            border-radius: 8px;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            background: rgba(255,255,255,0.6);
            font-weight: 500;
        }
        .word.highlight {
            background: linear-gradient(90deg, #ffeb3b, #ffa000) !important;
            color: #000 !important;
            font-weight: 800 !important;
            box-shadow: 0 6px 20px rgba(255,235,59,0.7);
            transform: scale(1.15);
            border: 3px solid #ff8f00;
            animation: glow 1s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 6px 20px rgba(255,235,59,0.7); }
            to { box-shadow: 0 6px 25px rgba(255,235,59,1); }
        }
        
        /* TVÃ… RÃ–ST-RUTOR */
        .voice-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        .voice-select-container {
            display: none;
        }
        .voice-select-container.active {
            display: block;
        }
        
        /* INSTÃ„LLNINGAR */
        .settings {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 25px 0;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        .setting { display: flex; flex-direction: column; gap: 8px; }
        .setting label { font-weight: 600; color: #4a5568; font-size: 14px; }
        input[type="range"] {
            width: 100%; height: 8px; border-radius: 5px;
            background: #e2e8f0; accent-color: #667eea; cursor: pointer;
        }
        .value { font-weight: bold; color: #667eea; font-size: 16px; text-align: center; }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }
        .btn:hover:not(:disabled) { transform: translateY(-3px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-play { background: linear-gradient(135deg, #48bb78, #38a169); }
        .btn-pause { background: linear-gradient(135deg, #ed8936, #dd6b20); }
        .btn-stop { background: linear-gradient(135deg, #f56565, #e53e3e); }
        .btn-record { 
            background: linear-gradient(135deg, #9f7aea, #805ad5); 
            grid-column: 1 / -1;
            margin-top: 10px;
        }
        select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            background: white;
        }
        .status {
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            display: none;
        }
        .status.show { display: block; animation: fadeIn 0.3s; }
        .status.playing { background: #c6f6d5; color: #22543d; }
        .status.error { background: #fed7d7; color: #c53030; }
        .status.recording { background: #e9d8fd; color: #5b21b6; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ Svenska + Engelska TTS</h1>
        <p class="subtitle">1.8 ord/sek + Stability + Record + 25+ rÃ¶ster</p>
        
        <div class="text-container" id="textContainer">
            Testa svenska och engelska rÃ¶ster! Klicka pÃ¥ flikarna ovanfÃ¶r.
        </div>
        
        <!-- FLIKAR FÃ–R SVENSKA/ENGELSKA -->
        <div class="voice-tabs">
            <button class="tab-btn active" onclick="switchVoiceTab('sv')">ğŸ‡¸ğŸ‡ª Svenska (12+)</button>
            <button class="tab-btn" onclick="switchVoiceTab('en')">ğŸ‡ºğŸ‡¸ Engelska (12+)</button>
        </div>
        
        <!-- SVENSKA RÃ–STER -->
        <div id="voiceSelectSv" class="voice-select-container active">
            <select id="voiceSelect">
                <optgroup label="ğŸ‡¸ğŸ‡ª Svenska RÃ¶ster">
                    <option value="pNInz6obpgDQGcFmaJgB">ğŸ‡¸ğŸ‡ª Erik (Manlig)</option>
                    <option value="AZnzlk1XvdvUeBnXmlld">ğŸ‡¸ğŸ‡ª Mette (Kvinnlig)</option>
                    <option value="21m00Tcm4TlvDq8ikWAM">ğŸ‡¸ğŸ‡ª Sofia (Kvinnlig)</option>
                    <option value="bVMeCyUxXxWGijw3xV1F">ğŸ‡¸ğŸ‡ª Oscar (Manlig)</option>
                    <option value="NYMB0I896s9V4U6OH0Ao">ğŸ‡¸ğŸ‡ª Lisa (Kvinnlig)</option>
                    <option value="VR6AewLTigWG4xSOukaG">ğŸ‡¸ğŸ‡ª Astrid</option>
                    <option value="TX3LPjmqiSv4veJb5s9J">ğŸ‡¸ğŸ‡ª Oscar Neural</option>
                    <option value="CYw3kZ02Hs0563khs1Fj">ğŸ‡¸ğŸ‡ª Johan</option>
                </optgroup>
                <optgroup label="ğŸŒ Nordiska">
                    <option value="EXAVITQu4vr4xnSDxMaL">ğŸŒ Adam (Premium)</option>
                    <option value="D38z5RcWu1voky8WS1ja">ğŸŒ BjÃ¸rn</option>
                    <option value="N2lVS1w4EtoT3Dr4wxR2">ğŸŒ Matilda</option>
                </optgroup>
            </select>
        </div>
        
        <!-- ENGELSKA RÃ–STER -->
        <div id="voiceSelectEn" class="voice-select-container">
            <select id="voiceSelectEn">
                <optgroup label="ğŸ‡ºğŸ‡¸ USA Engelska">
                    <option value="pNInz6obpgDQGcFmaJgB">ğŸ‡ºğŸ‡¸ Adam</option>
                    <option value="AZnzlk1XvdvUeBnXmlld">ğŸ‡ºğŸ‡¸ Rachel</option>
                    <option value="EXAVITQu4vr4xnSDxMaL">ğŸ‡ºğŸ‡¸ Josh</option>
                    <option value="D38z5RcWu1voky8WS1ja">ğŸ‡ºğŸ‡¸ Domi</option>
                    <option value="21m00Tcm4TlvDq8ikWAM">ğŸ‡ºğŸ‡¸ Bella</option>
                    <option value="TX3LPjmqiSv4veJb5s9J">ğŸ‡ºğŸ‡¸ Antoni</option>
                </optgroup>
                <optgroup label="ğŸ‡¬ğŸ‡§ Brittiska">
                    <option value="CYw3kZ02Hs0563khs1Fj">ğŸ‡¬ğŸ‡§ Elli</option>
                    <option value="VR6AewLTigWG4xSOukaG">ğŸ‡¬ğŸ‡§ Finley</option>
                    <option value="N2lVS1w4EtoT3Dr4wxR2">ğŸ‡¬ğŸ‡§ Grace</option>
                    <option value="bVMeCyUxXxWGijw3xV1F">ğŸ‡¬ğŸ‡§ Harry</option>
                </optgroup>
            </select>
        </div>
        
        <!-- INSTÃ„LLNINGAR -->
        <div class="settings">
            <div class="setting">
                <label>ğŸ™ï¸ Stability</label>
                <input type="range" id="stabilitySlider" min="0" max="1" step="0.1" value="0.5">
                <div class="value" id="stabilityValue">50% âš–ï¸ Neutral</div>
            </div>
            <div class="setting">
                <label>âš¡ Hastighet</label>
                <input type="range" id="speedSlider" min="0.5" max="2.0" step="0.1" value="1.0">
                <div class="value" id="speedValue">1.0x</div>
            </div>
            <div class="setting">
                <label>ğŸµ Likhet</label>
                <input type="range" id="similaritySlider" min="0" max="1" step="0.1" value="0.8">
                <div class="value" id="similarityValue">80%</div>
            </div>
        </div>
        
        <div class="controls">
            <div>
                <button class="btn btn-play" onclick="play()" id="playBtn">â–¶ï¸ Spela</button>
                <button class="btn btn-pause" onclick="pause()" id="pauseBtn" disabled>â¸ï¸ Pausa</button>
                <button class="btn btn-stop" onclick="stop()" id="stopBtn" disabled>â¹ï¸ Stoppa</button>
            </div>
        </div>
        
        <button class="btn btn-record" onclick="toggleRecord()" id="recordBtn">ğŸ™ï¸ Spela in</button>
        <div id="status" class="status"></div>
    </div>

    <script>
        const apiKey = "sk_60c4c7932387d49badab6bd0a03a90af0769b75e71157d90";
        let currentAudio = null;
        let words = [];
        let currentWordIndex = 0;
        let wordInterval = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;
        const WORDS_PER_SECOND = 1.8;
        const TIME_PER_WORD = 1000 / WORDS_PER_SECOND;
        let currentLanguage = 'sv';

        function switchVoiceTab(lang) {
            currentLanguage = lang;
            
            // Byt flik
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Visa rÃ¤tt select
            document.querySelectorAll('.voice-select-container').forEach(container => 
                container.classList.remove('active'));
            document.getElementById(`voiceSelect${lang.charAt(0).toUpperCase() + lang.slice(1)}`).classList.add('active');
        }

        function getVoiceSelect() {
            return currentLanguage === 'sv' ? 
                document.getElementById('voiceSelect') : 
                document.getElementById('voiceSelectEn');
        }

        function splitTextToWords(text) {
            return text
                .replace(/([.!?,;:])/g, ' $1 ')
                .split(/\s+/)
                .filter(w => w.trim().length > 0)
                .map(w => w.trim());
        }

        function renderTextWithWords(text) {
            const container = document.getElementById('textContainer');
            words = splitTextToWords(text);
            container.innerHTML = words.map((word, index) => 
                `<span class="word" data-index="${index}">${word}</span>`
            ).join(' ');
        }

        function highlightWord(index) {
            document.querySelectorAll('.word').forEach(w => w.classList.remove('highlight'));
            if (index >= 0 && index < words.length) {
                const wordEl = document.querySelector(`[data-index="${index}"]`);
                if (wordEl) {
                    wordEl.classList.add('highlight');
                    wordEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        function startWordHighlighting() {
            if (wordInterval) clearInterval(wordInterval);
            wordInterval = setInterval(() => {
                currentWordIndex = Math.min(currentWordIndex + 1, words.length - 1);
                highlightWord(currentWordIndex);
            }, TIME_PER_WORD);
        }

        function stopWordHighlighting() {
            if (wordInterval) clearInterval(wordInterval);
            wordInterval = null;
        }

        function clearHighlights() {
            document.querySelectorAll('.word').forEach(w => w.classList.remove('highlight'));
            currentWordIndex = 0;
        }

        // SLIDERS
        document.getElementById('stabilitySlider').oninput = function() {
            const val = Math.round(this.value * 100);
            document.getElementById('stabilityValue').textContent = 
                val + '% ' + (val < 30 ? 'ğŸŒ€ Kreativ' : val > 70 ? 'ğŸ›¡ï¸ Robust' : 'âš–ï¸ Neutral');
        };
        document.getElementById('speedSlider').oninput = function() {
            document.getElementById('speedValue').textContent = this.value + 'x';
        };
        document.getElementById('similaritySlider').oninput = function() {
            document.getElementById('similarityValue').textContent = 
                Math.round(this.value * 100) + '%';
        };

        function showStatus(msg, type = 'playing') {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.className = `status show ${type}`;
            setTimeout(() => status.classList.remove('show'), 2500);
        }

        async function toggleRecord() {
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    recordedChunks = [];
                    
                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) recordedChunks.push(e.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(recordedChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        const audio = new Audio(audioUrl);
                        audio.play();
                        showStatus('âœ… Inspelning klar!', 'playing');
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    document.getElementById('recordBtn').textContent = 'â¹ï¸ Stoppa inspelning';
                    document.getElementById('recordBtn').style.background = 'linear-gradient(135deg, #f56565, #e53e3e)';
                    showStatus('ğŸ™ï¸ Spelar in...', 'recording');
                    
                } catch (err) {
                    showStatus('âŒ Mikrofonfel!', 'error');
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('recordBtn').textContent = 'ğŸ™ï¸ Spela in';
                document.getElementById('recordBtn').style.background = 'linear-gradient(135deg, #9f7aea, #805ad5)';
            }
        }

        async function play() {
            const voiceSelect = getVoiceSelect();
            const voiceId = voiceSelect.value;
            const voiceName = voiceSelect.selectedOptions[0].text;
            
            if (!voiceId) return showStatus('âš ï¸ VÃ¤lj rÃ¶st!', 'error');
            
            let text = document.getElementById('textContainer').textContent.trim();
            if (!text || text.length < 20) {
                text = currentLanguage === 'sv' ? 
                    "VÃ¤lkommen till komplett text till tal med svenska och engelska rÃ¶ster." :
                    "Welcome to complete text-to-speech with Swedish and English voices.";
                renderTextWithWords(text);
            }
            
            stop();
            
            const stability = parseFloat(document.getElementById('stabilitySlider').value);
            const similarity = parseFloat(document.getElementById('similaritySlider').value);
            
            showStatus(`â³ ${voiceName}`);
            clearHighlights();
            
            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'xi-api-key': apiKey
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: { 
                            stability: stability,
                            similarity_boost: similarity
                        }
                    })
                });
                
                if (!response.ok) throw new Error(`Fel ${response.status}`);
                
                const audioBlob = await response.blob();
                currentAudio = new Audio(URL.createObjectURL(audioBlob));
                
                currentAudio.onplay = () => {
                    showStatus(`ğŸ”Š ${voiceName}`, 'playing');
                    updateButtons(true);
                    startWordHighlighting();
                };
                
                currentAudio.onended = () => {
                    showStatus('âœ… FÃ¤rdig!', 'playing');
                    clearHighlights();
                    updateButtons(false);
                    stopWordHighlighting();
                };
                
                currentAudio.play();
                
            } catch (error) {
                showStatus(`âŒ ${error.message}`, 'error');
            }
        }

        function pause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.getElementById('pauseBtn').textContent = 'â¸ï¸ Pausa';
                startWordHighlighting();
            } else {
                currentAudio.pause();
                document.getElementById('pauseBtn').textContent = 'â–¶ï¸ FortsÃ¤tt';
                stopWordHighlighting();
            }
        }

        function stop() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            updateButtons(false);
            clearHighlights();
            stopWordHighlighting();
            showStatus('â¹ï¸ Stoppad');
        }

        function updateButtons(playing) {
            document.getElementById('playBtn').disabled = playing;
            document.getElementById('pauseBtn').disabled = !playing;
            document.getElementById('stopBtn').disabled = !playing;
            if (!playing) document.getElementById('pauseBtn').textContent = 'â¸ï¸ Pausa';
        }

        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('word') && currentAudio) {
                const index = parseInt(e.target.dataset.index);
                currentWordIndex = index;
                highlightWord(index);
            }
        });
    </script>
</body>
</html>
