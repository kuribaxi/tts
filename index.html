<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé§ Fullscreen TTS + Klocka + Zoom</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        /* KLOCKA - L√§ngst upp */
        .clock {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            backdrop-filter: blur(15px);
            font-size: 20px;
            font-weight: bold;
            color: #2d3748;
            z-index: 1000;
            min-width: 140px;
            text-align: center;
        }
        
        /* FULLSCREEN TEXT - 80% av sk√§rmen */
        .text-container {
            background: rgba(247, 250, 252, 0.98);
            border: 3px solid #e2e8f0;
            border-radius: 20px;
            height: 80vh;
            margin: 60px 10px 120px 10px;
            padding: 30px;
            font-size: clamp(24px, 5vw, 48px);
            line-height: 1.6;
            overflow-y: auto;
            scroll-behavior: smooth;
            position: relative;
        }
        .word {
            display: inline-block;
            margin: 0 6px 12px 0;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            background: rgba(255,255,255,0.7);
            font-weight: 600;
        }
        .word.highlight {
            background: linear-gradient(90deg, #ffeb3b, #ffa000) !important;
            color: #000 !important;
            font-weight: 900 !important;
            box-shadow: 0 8px 25px rgba(255,235,59,0.8);
            transform: scale(1.2);
            border: 4px solid #ff8f00;
            animation: glow 1.2s ease-in-out infinite alternate;
            z-index: 10;
        }
        @keyframes glow {
            from { box-shadow: 0 8px 25px rgba(255,235,59,0.8); }
            to { box-shadow: 0 8px 35px rgba(255,235,59,1); }
        }
        
        /* KONTROLLPANEL l√§ngst ner */
        .controls-panel {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            max-width: 95%;
            z-index: 100;
        }
        
        /* ZOOM-KNAPpar */
        .zoom-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }
        .zoom-btn {
            width: 60px; height: 60px;
            border: none; border-radius: 50%;
            font-size: 24px; font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .zoom-btn:hover { transform: scale(1.1); }
        .zoom-in { background: linear-gradient(135deg, #10b981, #059669); }
        .zoom-out { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .zoom-text {
            font-size: 18px; font-weight: bold; color: #4a5568;
            text-align: center; margin-bottom: 5px;
        }
        
        /* FLIKAR OCH R√ñSTER */
        .voice-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #4a5568;
            background: rgba(255,255,255,0.7);
        }
        .tab-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        .voice-select-container { display: none; }
        .voice-select-container.active { display: block; }
        
        /* SLIDERS OCH KNAPpar */
        .settings {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        .setting {
            display: flex; flex-direction: column; gap: 6px;
        }
        .setting label {
            font-weight: 600; color: #4a5568; font-size: 12px;
        }
        input[type="range"] {
            width: 100%; height: 6px; border-radius: 3px;
            background: #e2e8f0; accent-color: #667eea;
        }
        .value {
            font-weight: bold; color: #667eea; font-size: 12px;
            text-align: center;
        }
        
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            margin-bottom: 10px;
        }
        
        .play-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            flex: 1;
        }
        .btn:hover:not(:disabled) { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-play { background: linear-gradient(135deg, #48bb78, #38a169); }
        .btn-pause { background: linear-gradient(135deg, #ed8936, #dd6b20); }
        .btn-stop { background: linear-gradient(135deg, #f56565, #e53e3e); }
        .btn-record {
            background: linear-gradient(135deg, #9f7aea, #805ad5);
            padding: 14px 24px; width: auto;
        }
        
        .status {
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        .status.show { display: block; animation: fadeIn 0.3s; }
        .status.playing { background: #c6f6d5; color: #22543d; }
        .status.error { background: #fed7d7; color: #c53030; }
        .status.recording { background: #e9d8fd; color: #5b21b6; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <!-- LEVANDE KLOCKA -->
    <div class="clock" id="clock">12:20</div>
    
    <div class="text-container" id="textContainer">
        üïê Klockan visas l√§ngst upp till h√∂ger! Anv√§nd ‚ûï‚ûñ f√∂r att zooma texten.
    </div>
    
    <div class="controls-panel">
        <!-- ZOOM -->
        <div class="zoom-controls">
            <button class="zoom-btn zoom-out" onclick="zoomText(-2)">‚ûñ</button>
            <div class="zoom-text" id="zoomDisplay">Textstorlek: Normal</div>
            <button class="zoom-btn zoom-in" onclick="zoomText(2)">‚ûï</button>
        </div>
        
        <!-- FLIKAR -->
        <div class="voice-tabs">
            <button class="tab-btn active" onclick="switchVoiceTab('sv')">üá∏üá™ Svenska</button>
            <button class="tab-btn" onclick="switchVoiceTab('en')">üá∫üá∏ Engelska</button>
        </div>
        
        <!-- R√ñSTER -->
        <div id="voiceSelectSv" class="voice-select-container active">
            <select id="voiceSelect">
                <optgroup label="üá∏üá™ Svenska">
                    <option value="pNInz6obpgDQGcFmaJgB">Erik</option>
                    <option value="AZnzlk1XvdvUeBnXmlld">Mette</option>
                    <option value="21m00Tcm4TlvDq8ikWAM">Sofia</option>
                    <option value="bVMeCyUxXxWGijw3xV1F">Oscar</option>
                    <option value="NYMB0I896s9V4U6OH0Ao">Lisa</option>
                </optgroup>
            </select>
        </div>
        <div id="voiceSelectEn" class="voice-select-container">
            <select id="voiceSelectEn">
                <optgroup label="üá∫üá∏ Engelska">
                    <option value="EXAVITQu4vr4xnSDxMaL">Adam</option>
                    <option value="D38z5RcWu1voky8WS1ja">Rachel</option>
                    <option value="TX3LPjmqiSv4veJb5s9J">Josh</option>
                </optgroup>
            </select>
        </div>
        
        <!-- SLIDERS -->
        <div class="settings">
            <div class="setting">
                <label>üéôÔ∏è Stability</label>
                <input type="range" id="stabilitySlider" min="0" max="1" step="0.1" value="0.5">
                <div class="value" id="stabilityValue">50%</div>
            </div>
            <div class="setting">
                <label>‚ö° Hastighet</label>
                <input type="range" id="speedSlider" min="0.5" max="2.0" step="0.1" value="1.0">
                <div class="value" id="speedValue">1.0x</div>
            </div>
            <div class="setting">
                <label>üéµ Likhet</label>
                <input type="range" id="similaritySlider" min="0" max="1" step="0.1" value="0.8">
                <div class="value" id="similarityValue">80%</div>
            </div>
        </div>
        
        <!-- KNAPpar -->
        <div class="play-controls">
            <button class="btn btn-play" onclick="play()" id="playBtn">‚ñ∂Ô∏è Spela</button>
            <button class="btn btn-pause" onclick="pause()" id="pauseBtn" disabled>‚è∏Ô∏è Pausa</button>
            <button class="btn btn-stop" onclick="stop()" id="stopBtn" disabled>‚èπÔ∏è Stoppa</button>
        </div>
        <button class="btn btn-record" onclick="toggleRecord()" id="recordBtn">üéôÔ∏è Spela in</button>
        <div id="status" class="status"></div>
    </div>

    <script>
        const apiKey = "sk_60c4c7932387d49badab6bd0a03a90af0769b75e71157d90";
        let currentAudio = null;
        let words = [];
        let currentWordIndex = 0;
        let wordInterval = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;
        let textSize = 100;
        let currentLanguage = 'sv';
        const WORDS_PER_SECOND = 1.8;
        const TIME_PER_WORD = 1000 / WORDS_PER_SECOND;

        // üïê LEVANDE KLOCKA
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('sv-SE', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('clock').textContent = timeString;
        }
        updateClock();
        setInterval(updateClock, 1000);

        // ZOOM FUNKTION
        function zoomText(delta) {
            textSize = Math.max(50, Math.min(300, textSize + delta));
            const container = document.getElementById('textContainer');
            container.style.fontSize = `clamp(24px, ${textSize * 0.5}px, 72px)`;
            
            const sizes = {
                50: 'Mycket liten', 75: 'Liten', 100: 'Normal', 
                125: 'Stor', 150: 'Mycket stor', 200: 'J√§ttestor', 300: 'Max'
            };
            const displaySize = sizes[Math.floor(textSize / 25) * 25] || 'Custom';
            document.getElementById('zoomDisplay').textContent = `Textstorlek: ${displaySize}`;
        }

        function switchVoiceTab(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.voice-select-container').forEach(c => c.classList.remove('active'));
            document.getElementById(`voiceSelect${lang === 'sv' ? '' : 'En'}`).classList.add('active');
        }

        function getVoiceSelect() {
            return currentLanguage === 'sv' ? document.getElementById('voiceSelect') : document.getElementById('voiceSelectEn');
        }

        function splitTextToWords(text) {
            return text.replace(/([.!?,;:])/g, ' $1 ')
                .split(/\s+/)
                .filter(w => w.trim().length > 0)
                .map(w => w.trim());
        }

        function renderTextWithWords(text) {
            const container = document.getElementById('textContainer');
            words = splitTextToWords(text);
            container.innerHTML = words.map((word, index) => 
                `<span class="word" data-index="${index}">${word}</span>`
            ).join(' ');
        }

        function highlightWord(index) {
            document.querySelectorAll('.word').forEach(w => w.classList.remove('highlight'));
            if (index >= 0 && index < words.length) {
                const wordEl = document.querySelector(`[data-index="${index}"]`);
                if (wordEl) {
                    wordEl.classList.add('highlight');
                    wordEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        function startWordHighlighting() {
            if (wordInterval) clearInterval(wordInterval);
            wordInterval = setInterval(() => {
                currentWordIndex = Math.min(currentWordIndex + 1, words.length - 1);
                highlightWord(currentWordIndex);
            }, TIME_PER_WORD);
        }

        function stopWordHighlighting() {
            if (wordInterval) clearInterval(wordInterval);
            wordInterval = null;
        }

        function clearHighlights() {
            document.querySelectorAll('.word').forEach(w => w.classList.remove('highlight'));
            currentWordIndex = 0;
        }

        // SLIDERS
        document.getElementById('stabilitySlider').oninput = function() {
            document.getElementById('stabilityValue').textContent = Math.round(this.value * 100) + '%';
        };
        document.getElementById('speedSlider').oninput = function() {
            document.getElementById('speedValue').textContent = this.value + 'x';
        };
        document.getElementById('similaritySlider').oninput = function() {
            document.getElementById('similarityValue').textContent = Math.round(this.value * 100) + '%';
        };

        function showStatus(msg, type = 'playing') {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.className = `status show ${type}`;
            setTimeout(() => status.classList.remove('show'), 2500);
        }

        async function toggleRecord() {
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    recordedChunks = [];
                    mediaRecorder.ondataavailable = (e) => recordedChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(recordedChunks, { type: 'audio/wav' });
                        new Audio(URL.createObjectURL(audioBlob)).play();
                        showStatus('‚úÖ Inspelning klar!', 'playing');
                        stream.getTracks().forEach(track => track.stop());
                    };
                    mediaRecorder.start();
                    isRecording = true;
                    document.getElementById('recordBtn').textContent = '‚èπÔ∏è Stoppa';
                    document.getElementById('recordBtn').style.background = 'linear-gradient(135deg, #f56565, #e53e3e)';
                    showStatus('üéôÔ∏è Spelar in...', 'recording');
                } catch (err) {
                    showStatus('‚ùå Mikrofonfel!', 'error');
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('recordBtn').textContent = 'üéôÔ∏è Spela in';
                document.getElementById('recordBtn').style.background = 'linear-gradient(135deg, #9f7aea, #805ad5)';
            }
        }

        async function play() {
            const voiceSelect = getVoiceSelect();
            const voiceId = voiceSelect.value;
            const voiceName = voiceSelect.selectedOptions[0].text;
            
            if (!voiceId) return showStatus('‚ö†Ô∏è V√§lj r√∂st!', 'error');
            
            let text = document.getElementById('textContainer').textContent.trim();
            if (!text || text.length < 20) {
                text = currentLanguage === 'sv' ? 
                    "üïê Klockan tickar l√§ngst upp! V√§lkommen till fullscreen TTS med perfekt h√∂gtextning." :
                    "üïê Clock ticks at top! Welcome to fullscreen TTS with perfect highlighting.";
                renderTextWithWords(text);
            }
            
            stop();
            const stability = parseFloat(document.getElementById('stabilitySlider').value);
            const similarity = parseFloat(document.getElementById('similaritySlider').value);
            
            showStatus(`‚è≥ ${voiceName}`);
            clearHighlights();
            
            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'xi-api-key': apiKey },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: { stability, similarity_boost: similarity }
                    })
                });
                
                if (!response.ok) throw new Error(`Fel ${response.status}`);
                
                const audioBlob = await response.blob();
                currentAudio = new Audio(URL.createObjectURL(audioBlob));
                
                currentAudio.onplay = () => {
                    showStatus(`üîä ${voiceName}`, 'playing');
                    updateButtons(true);
                    startWordHighlighting();
                };
                currentAudio.onended = () => {
                    showStatus('‚úÖ F√§rdig!', 'playing');
                    clearHighlights();
                    updateButtons(false);
                    stopWordHighlighting();
                };
                currentAudio.play();
            } catch (error) {
                showStatus(`‚ùå ${error.message}`, 'error');
            }
        }

        function pause() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pausa';
                startWordHighlighting();
            } else {
                currentAudio.pause();
                document.getElementById('pauseBtn').textContent = '‚ñ∂Ô∏è Forts√§tt';
                stopWordHighlighting();
            }
        }

        function stop() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            updateButtons(false);
            clearHighlights();
            stopWordHighlighting();
            showStatus('‚èπÔ∏è Stoppad');
        }

        function updateButtons(playing) {
            document.getElementById('playBtn').disabled = playing;
            document.getElementById('pauseBtn').disabled = !playing;
            document.getElementById('stopBtn').disabled = !playing;
            if (!playing) document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pausa';
        }

        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('word') && currentAudio) {
                const index = parseInt(e.target.dataset.index);
                currentWordIndex = index;
                highlightWord(index);
            }
        });
    </script>
</body>
</html>
