<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>ğŸ¤ Svenska + Engelska RÃ¶ster + Record</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;padding:20px;display:flex;align-items:center;justify-content:center;}
    .container{background:rgba(255,255,255,0.95);border-radius:20px;padding:30px;max-width:1100px;width:100%;
      box-shadow:0 20px 60px rgba(0,0,0,0.3);}
    h1{text-align:center;color:#4a5568;margin-bottom:10px;}
    .subtitle{text-align:center;color:#666;margin-bottom:25px;}
    .text-container{background:#f7fafc;border:2px solid #e2e8f0;border-radius:12px;
      padding:25px;min-height:180px;margin-bottom:20px;font-size:22px;line-height:1.9;overflow-y:auto;max-height:320px;}
    .word{display:inline-block;margin:0 4px 10px 0;padding:5px 8px;border-radius:8px;
      background:rgba(255,255,255,0.6);font-weight:500;cursor:pointer;transition:0.3s;}
    .word.highlight{background:linear-gradient(90deg,#ffeb3b,#ffa000);color:#000;font-weight:800;
      border:2px solid #ff8f00;transform:scale(1.15);}
    .voice-tabs{display:flex;gap:10px;margin-bottom:20px;}
    .tab-btn{flex:1;padding:12px;border:none;border-radius:10px;font-weight:bold;cursor:pointer;transition:0.3s;}
    .tab-btn.active{background:#667eea;color:#fff;transform:translateY(-2px);}
    .voice-select-container{display:none;}
    .voice-select-container.active{display:block;}
    .settings{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin:25px 0;padding:20px;
      background:#f8f9ff;border-radius:12px;border:1px solid #e2e8f0;}
    .setting{display:flex;flex-direction:column;gap:8px;}
    select,input[type=range]{width:100%;padding:10px;border:2px solid #e2e8f0;border-radius:10px;}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:20px 0;}
    .btn{padding:14px 24px;font-size:16px;font-weight:bold;border:none;border-radius:12px;color:#fff;cursor:pointer;}
    .btn-play{background:linear-gradient(135deg,#48bb78,#38a169);}
    .btn-pause{background:linear-gradient(135deg,#ed8936,#dd6b20);}
    .btn-stop{background:linear-gradient(135deg,#f56565,#e53e3e);}
    .btn-record{background:linear-gradient(135deg,#9f7aea,#805ad5);grid-column:1 / -1;margin-top:10px;}
    .status{margin-top:20px;text-align:center;font-weight:bold;display:none;}
    .status.show{display:block;}
    .status.playing{background:#c6f6d5;color:#22543d;padding:10px;border-radius:10px;}
    .status.error{background:#fed7d7;color:#c53030;padding:10px;border-radius:10px;}
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ§ Svenska + Engelska TTS + Record</h1>
  <p class="subtitle">Testa svenska, nordiska och engelska rÃ¶ster med full kontroll.</p>

  <div class="text-container" id="textContainer">
    VÃ¤lkommen till avancerad text-till-tal med flera sprÃ¥k och rÃ¶ster!
  </div>

  <div class="voice-tabs">
    <button class="tab-btn active" onclick="switchVoiceTab(event,'sv')">ğŸ‡¸ğŸ‡ª Svenska (15+)</button>
    <button class="tab-btn" onclick="switchVoiceTab(event,'en')">ğŸ‡ºğŸ‡¸ Engelska (12+)</button>
  </div>

  <div id="voiceSelectSv" class="voice-select-container active">
    <select id="voiceSelect">
      <optgroup label="ğŸ‡¸ğŸ‡ª Svenska RÃ¶ster">
        <option value="pNInz6obpgDQGcFmaJgB">ğŸ‡¸ğŸ‡ª Erik (Manlig)</option>
        <option value="AZnzlk1XvdvUeBnXmlld">ğŸ‡¸ğŸ‡ª Mette (Kvinnlig)</option>
        <option value="21m00Tcm4TlvDq8ikWAM">ğŸ‡¸ğŸ‡ª Sofia (Kvinnlig)</option>
        <option value="bVMeCyUxXxWGijw3xV1F">ğŸ‡¸ğŸ‡ª Oscar (Manlig)</option>
        <option value="NYMB0I896s9V4U6OH0Ao">ğŸ‡¸ğŸ‡ª Lisa (Kvinnlig)</option>
        <option value="VR6AewLTigWG4xSOukaG">ğŸ‡¸ğŸ‡ª Astrid (Svensk)</option>
        <option value="TX3LPjmqiSv4veJb5s9J">ğŸ‡¸ğŸ‡ª Oscar Neural</option>
        <option value="CYw3kZ02Hs0563khs1Fj">ğŸ‡¸ğŸ‡ª Johan (Svensk)</option>
      </optgroup>
      <optgroup label="ğŸŒ Nordiska/Premium">
        <option value="EXAVITQu4vr4xnSDxMaL">ğŸŒ Adam (Premium)</option>
        <option value="D38z5RcWu1voky8WS1ja">ğŸŒ BjÃ¸rn (Nordisk)</option>
        <option value="N2lVS1w4EtoT3Dr4wxR2">ğŸŒ Matilda (Nordisk)</option>
        <option value="Xb7f8W7L3k9pQ2mN4vRt">ğŸŒ Premium Svensk</option>
      </optgroup>
    </select>
  </div>

  <div id="voiceSelectEn" class="voice-select-container">
    <select id="voiceSelectEn">
      <optgroup label="ğŸ‡ºğŸ‡¸ Amerikanska">
        <option value="pNInz6obpgDQGcFmaJgB">ğŸ‡ºğŸ‡¸ Adam</option>
        <option value="AZnzlk1XvdvUeBnXmlld">ğŸ‡ºğŸ‡¸ Rachel</option>
        <option value="EXAVITQu4vr4xnSDxMaL">ğŸ‡ºğŸ‡¸ Josh</option>
        <option value="D38z5RcWu1voky8WS1ja">ğŸ‡ºğŸ‡¸ Domi</option>
        <option value="21m00Tcm4TlvDq8ikWAM">ğŸ‡ºğŸ‡¸ Bella</option>
        <option value="TX3LPjmqiSv4veJb5s9J">ğŸ‡ºğŸ‡¸ Antoni</option>
      </optgroup>
      <optgroup label="ğŸ‡¬ğŸ‡§ Brittiska">
        <option value="CYw3kZ02Hs0563khs1Fj">ğŸ‡¬ğŸ‡§ Elli</option>
        <option value="VR6AewLTigWG4xSOukaG">ğŸ‡¬ğŸ‡§ Finley</option>
        <option value="N2lVS1w4EtoT3Dr4wxR2">ğŸ‡¬ğŸ‡§ Grace</option>
        <option value="bVMeCyUxXxWGijw3xV1F">ğŸ‡¬ğŸ‡§ Harry</option>
      </optgroup>
    </select>
  </div>

  <div class="settings">
    <div class="setting">
      <label>ğŸ™ï¸ Stability</label>
      <input type="range" id="stabilitySlider" min="0" max="1" step="0.1" value="0.5">
    </div>
    <div class="setting">
      <label>âš¡ Hastighet</label>
      <input type="range" id="speedSlider" min="0.5" max="2.0" step="0.1" value="1.0">
    </div>
    <div class="setting">
      <label>ğŸµ Likhet</label>
      <input type="range" id="similaritySlider" min="0" max="1" step="0.1" value="0.8">
    </div>
  </div>

  <div class="controls">
    <button class="btn btn-play" onclick="play()" id="playBtn">â–¶ï¸ Spela</button>
    <button class="btn btn-pause" onclick="pause()" id="pauseBtn" disabled>â¸ï¸ Pausa</button>
    <button class="btn btn-stop" onclick="stop()" id="stopBtn" disabled>â¹ï¸ Stoppa</button>
  </div>

  <button class="btn btn-record" onclick="toggleRecord()" id="recordBtn">ğŸ™ï¸ Spela in</button>
  <div id="status" class="status"></div>
</div>

<script>
let currentAudio=null, currentWordIndex=0, words=[], wordInterval, isRecording=false, mediaRecorder, recordedChunks=[];
let currentLanguage='sv';
const WORDS_PER_SECOND=1.8, TIME_PER_WORD=1000/WORDS_PER_SECOND;

// API-nyckel tillagd och fixad
const apiKey="sk_23980f62f1571d5de8f33673fce1493b3b520a37c3cdb51fda704aeb4373d722";

function switchVoiceTab(event,lang){
  currentLanguage=lang;
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  document.querySelectorAll('.voice-select-container').forEach(c=>c.classList.remove('active'));
  document.getElementById(`voiceSelect${lang.charAt(0).toUpperCase()+lang.slice(1)}`).classList.add('active');
}
function getVoiceSelect(){return currentLanguage==='sv'?document.getElementById('voiceSelect'):document.getElementById('voiceSelectEn');}
function splitTextToWords(t){return t.replace(/([.!?,;:])/g,' $1 ').split(/\s+/).filter(w=>w.trim()).map(w=>w.trim());}
function renderWords(t){const c=document.getElementById('textContainer');words=splitTextToWords(t);
  c.innerHTML=words.map((w,i)=>`<span class='word' data-index='${i}'>${w}</span>`).join(' ');}
function highlightWord(i){document.querySelectorAll('.word').forEach(w=>w.classList.remove('highlight'));
  const e=document.querySelector(`[data-index='${i}']`);if(e)e.classList.add('highlight');}
function startHighlight(){stopHighlight();wordInterval=setInterval(()=>{currentWordIndex=Math.min(currentWordIndex+1,words.length-1);
  highlightWord(currentWordIndex);},TIME_PER_WORD);}
function stopHighlight(){if(wordInterval)clearInterval(wordInterval);}
function updateButtons(p){playBtn.disabled=p;pauseBtn.disabled=!p;stopBtn.disabled=!p;if(!p)pauseBtn.textContent='â¸ï¸ Pausa';}
function showStatus(t,ty='playing'){const s=document.getElementById('status');s.textContent=t;s.className=`status show ${ty}`;}

async function play(){
  const v=getVoiceSelect();const id=v.value;const name=v.selectedOptions[0].text;
  if(!id)return showStatus('âš ï¸ VÃ¤lj rÃ¶st!','error');
  let text=document.getElementById('textContainer').textContent.trim();
  if(!text||text.length<5){text=currentLanguage==='sv'?'Hej! Detta Ã¤r ett svenskt rÃ¶stdemo.':'Hello! This is an English TTS demo.';renderWords(text);}
  stop();showStatus('â³ Laddar rÃ¶st...');
  const st=parseFloat(stabilitySlider.value), sim=parseFloat(similaritySlider.value), speed=parseFloat(speedSlider.value);
  try{
    const res=await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${id}`,{
      method:'POST',
      headers:{'Content-Type':'application/json','xi-api-key':apiKey},
      body:JSON.stringify({text:text,model_id:'eleven_multilingual_v2',voice_settings:{stability:st,similarity_boost:sim}})
    });
    if(!res.ok)throw new Error('Fel '+res.status);
    const blob=await res.blob();const url=URL.createObjectURL(blob);
    currentAudio=new Audio(url);currentAudio.playbackRate=speed;
    currentAudio.onplay=()=>{updateButtons(true);showStatus('ğŸ”Š Spelar...');startHighlight();};
    currentAudio.onended=()=>{updateButtons(false);showStatus('âœ… FÃ¤rdig!');stopHighlight();};
    currentAudio.play();
  }catch(e){showStatus('âŒ '+e.message,'error');}
}
function pause(){if(!currentAudio)return;if(currentAudio.paused){currentAudio.play();pauseBtn.textContent='â¸ï¸ Pausa';startHighlight();}
else{currentAudio.pause();pauseBtn.textContent='â–¶ï¸ FortsÃ¤tt';stopHighlight();}}
function stop(){if(currentAudio){currentAudio.pause();currentAudio.currentTime=0;}updateButtons(false);stopHighlight();}
async function toggleRecord(){
  const b=document.getElementById('recordBtn');
  if(!isRecording){try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});mediaRecorder=new MediaRecorder(stream);recordedChunks=[];
    mediaRecorder.ondataavailable=e=>{if(e.data.size>0)recordedChunks.push(e.data);};
    mediaRecorder.onstop=()=>{const blob=new Blob(recordedChunks,{type:'audio/wav'});new Audio(URL.createObjectURL(blob)).play();
      showStatus('âœ… Inspelning spelas upp!');stream.getTracks().forEach(t=>t.stop());};
    mediaRecorder.start();isRecording=true;b.textContent='â¹ï¸ Stoppa inspelning';
  }catch(err){showStatus('âŒ Mikrofonfel: '+err.message,'error');}}
  else{mediaRecorder.stop();isRecording=false;b.textContent='ğŸ™ï¸ Spela in';}
}
</script>
</body>
</html>
