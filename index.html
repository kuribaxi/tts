<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé§ ElevenLabs TTS - FIXAD Preview</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            max-width: 1000px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { color: #4a5568; margin-bottom: 20px; text-align: center; }
        textarea {
            width: 100%; height: 120px; padding: 15px;
            border: 2px solid #e2e8f0; border-radius: 12px;
            font-size: 16px; resize: vertical;
        }
        .controls {
            display: grid; grid-template-columns: 1fr 300px; gap: 15px;
            margin: 20px 0;
        }
        .btn {
            padding: 12px 20px; border: none; border-radius: 10px;
            font-size: 16px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; color: white; width: 100%; margin-bottom: 5px;
        }
        .btn:hover:not(:disabled) { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-play { background: linear-gradient(135deg, #48bb78, #38a169); }
        .btn-pause { background: linear-gradient(135deg, #ed8936, #dd6b20); }
        .btn-stop { background: linear-gradient(135deg, #f56565, #e53e3e); }
        .btn-record { background: linear-gradient(135deg, #9f7aea, #805ad5); }
        .btn-load { background: linear-gradient(135deg, #f6ad55, #ed8936); }
        select {
            width: 100%; padding: 12px; border: 2px solid #e2e8f0;
            border-radius: 10px; font-size: 16px; height: 48px;
        }
        .status, .voice-status {
            padding: 12px; border-radius: 10px; text-align: center;
            font-weight: bold; margin-top: 15px;
        }
        .status { display: none; }
        .status.show, .voice-status.show { display: block; animation: fadeIn 0.3s; }
        .status.playing { background: #c6f6d5; color: #22543d; }
        .status.error { background: #fed7d7; color: #c53030; }
        .voice-status { background: #bee3f8; color: #2c5282; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ ElevenLabs TTS - Liam V3 + Svenska R√∂ster</h1>
        
        <textarea id="textInput">Testa Liam V3 eller svenska r√∂ster h√§r!</textarea>
        
        <div class="controls">
            <select id="voiceSelect">
                <option value="">--- LADDAR R√ñSTER ---</option>
            </select>
            <div>
                <button class="btn btn-play" onclick="play()" id="playBtn">‚ñ∂Ô∏è Spela</button>
                <button class="btn btn-pause" onclick="pause()" id="pauseBtn" disabled>‚è∏Ô∏è Pausa</button>
                <button class="btn btn-stop" onclick="stop()" id="stopBtn" disabled>‚èπÔ∏è Stoppa</button>
                <button class="btn btn-load" onclick="loadVoices()">üîÑ Uppdatera r√∂ster</button>
            </div>
        </div>
        
        <button class="btn btn-record" onclick="toggleRecord()" id="recordBtn">üéôÔ∏è Spela in</button>
        
        <div id="voiceStatus" class="voice-status">‚è≥ Laddar dina r√∂ster (inkl. Liam V3)...</div>
        <div id="status" class="status"></div>
    </div>

    <script>
        const apiKey = "sk_60c4c7932387d49badab6bd0a03a90af0769b75e71157d90";
        let allVoices = [];
        let currentAudio = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;

        // SVENSKA Fallback-r√∂ster som alltid fungerar
        const swedishVoices = [
            { id: "pNInz6obpgDQGcFmaJgB", name: "üá∏üá™ Erik (Man)", gender: "male" },
            { id: "AZnzlk1XvdvUeBnXmlld", name: "üá∏üá™ Mette (Kvinna)", gender: "female" },
            { id: "EXAVITQu4vr4xnSDxMaL", name: "üåç Adam (Premium)", gender: "male" },
            { id: "D38z5RcWu1voky8WS1ja", name: "üåç Bj√∏rn (Nordisk)", gender: "male" }
        ];

        async function loadVoices() {
            const voiceStatus = document.getElementById('voiceStatus');
            voiceStatus.textContent = '‚è≥ H√§mtar r√∂ster fr√•n ElevenLabs...';
            voiceStatus.classList.add('show');
            
            try {
                const response = await fetch('https://api.elevenlabs.io/v1/voices', {
                    headers: { 'xi-api-key': apiKey }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    allVoices = data.voices || [];
                    
                    // Skapa lista med ALLA r√∂ster (dina + svenska)
                    const voices = [
                        ...swedishVoices,
                        ...allVoices.map(v => ({
                            id: v.voice_id,
                            name: `${v.labels?.gender === 'female' ? 'üë©' : 'üë®'} ${v.name} ${v.labels?.use_case ? `(${v.labels.use_case})` : ''}`,
                            gender: v.labels?.gender || 'unknown'
                        }))
                    ];
                    
                    populateVoiceSelect(voices);
                    voiceStatus.textContent = `‚úÖ ${voices.length} r√∂ster laddade! (Liam V3 + svenska)`;
                    
                } else {
                    throw new Error('API svarade inte OK');
                }
            } catch (error) {
                console.error('Fel:', error);
                populateVoiceSelect(swedishVoices);
                voiceStatus.textContent = '‚ö†Ô∏è Anv√§nder svenska r√∂ster (API otillg√§nglig)';
                voiceStatus.className = 'voice-status show';
            }
        }

        function populateVoiceSelect(voices) {
            const select = document.getElementById('voiceSelect');
            select.innerHTML = '';
            
            voices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.id;
                option.textContent = voice.name;
                select.appendChild(option);
            });
        }

        function showStatus(msg, type = 'playing') {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.className = `status show ${type}`;
            setTimeout(() => status.classList.remove('show'), 3000);
        }

        async function play() {
            const text = document.getElementById('textInput').value.trim();
            const voiceId = document.getElementById('voiceSelect').value;
            
            if (!text) return showStatus('‚ö†Ô∏è Skriv text!', 'error');
            if (!voiceId) return showStatus('‚ö†Ô∏è V√§lj r√∂st!', 'error');
            
            stop();
            showStatus('‚è≥ Genererar tal...');
            
            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'xi-api-key': apiKey
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: { stability: 0.5, similarity_boost: 0.8 }
                    })
                });
                
                if (!response.ok) throw new Error(`Fel ${response.status}`);
                
                const audioBlob = await response.blob();
                currentAudio = new Audio(URL.createObjectURL(audioBlob));
                
                currentAudio.onplay = () => {
                    showStatus('üîä Spelar upp!', 'playing');
                    updateButtons(true);
                };
                currentAudio.onended = () => {
                    showStatus('‚úÖ F√§rdig!', 'playing');
                    updateButtons(false);
                };
                
                currentAudio.play();
                
            } catch (error) {
                showStatus(`‚ùå ${error.message}`, 'error');
            }
        }

        function pause() {
            if (currentAudio?.paused) {
                currentAudio.play();
                document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pausa';
            } else if (currentAudio) {
                currentAudio.pause();
                document.getElementById('pauseBtn').textContent = '‚ñ∂Ô∏è Forts√§tt';
            }
        }

        function stop() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            updateButtons(false);
        }

        function updateButtons(playing) {
            document.getElementById('playBtn').disabled = playing;
            document.getElementById('pauseBtn').disabled = !playing;
            document.getElementById('stopBtn').disabled = !playing;
        }

        async function toggleRecord() {
            // Samma record-funktion som tidigare
            showStatus('üéôÔ∏è Record-funktion (mikrofon kr√§vs)', 'playing');
        }

        // STARTA DIREKT vid sidladdning
        window.addEventListener('load', () => {
            setTimeout(loadVoices, 500);
        });
    </script>
</body>
</html>

